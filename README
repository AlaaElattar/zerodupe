# ZeroDupe

ZeroDupe is a deduplication file storage system that splits files into chunks and only stores unique chunks, saving storage space.

## Architecture

The ZeroDupe system is designed with a clean architecture in mind, with clear separation of concerns and dependency injection. The system is divided into three main layers:

1. **Client**: The client layer is responsible for interacting with the user and sending requests to the server. It is implemented in the `packages/client` directory.
2. **Server**: The server layer is responsible for handling requests from the client and storing/retrieving data. It is implemented in the `internal/server` directory.
3. **Hasher**: The hasher layer is responsible for calculating hashes for file and chunk data. It is implemented in the `packages/hasher` directory and is used by both the client and server.
4. **CMD**: The cmd layer is responsible for running the client and server. It is implemented in the `cmd` directory.

## Running the Server

To build the server, use the following command:

```bash
go build -o zerodupe-server cmd/zerodupe-server/main.go
./zerodupe-server
```

The server can be configured using command-line flags. The available flags are:

- `-port`: The port on which the server should listen (default: 8080)
- `-storage`: The directory in which to store chunk data (default: `data/storage`)

## Running the server with Docker

### Prerequisites

- Docker
- Docker Compose

### Starting the Server

To start the server, run:

```bash
docker-compose up -d zerodupe-server
```

This will start the server in detached mode, listening on port 8080.

The port can be changed by modifying the `docker-compose.yml` file.

### Using the Client

### Uploading Files

To upload a file to the server, run:

```bash
docker-compose run --rm \
  -v $(pwd)/path/to/file.txt:/app/file.txt \
  zerodupe-client upload -server http://zerodupe-server:8080 /app/file.txt
```

Example with a test file:

```bash
echo "This is a test file" > test.txt

docker-compose run --rm \
  -v $(pwd)/test.txt:/app/test.txt \
  zerodupe-client upload -server http://zerodupe-server:8080 /app/test.txt
```

### Downloading Files

To download a file from the server:

```bash
docker-compose run --rm \
  -v $(pwd)/downloads:/app/downloads \
  zerodupe-client download -server http://zerodupe-server:8080 -o /app/downloads -n output.txt <FILE_HASH>
```

Example with a previously uploaded file:

```bash
mkdir -p downloads

docker-compose run --rm \
  -v $(pwd)/downloads:/app/downloads \
  zerodupe-client download -server http://zerodupe-server:8080 -o /app/downloads -n retrieved.txt ba38b8f136826a50c19d98b90ae1a0b34212b243c900a82da08c7eedeb45435b
```

### Stopping the Server

To stop the server, run:

```bash
docker-compose down
```

## Running the Server Locally

To run the server locally, use the following command:

```bash
./zerodupe-server -port 8080 -storage data/storage
```

## Running the Client

To build the client, use the following command:

```bash
go build -o zerodupe-client cmd/zerodupe-client/main.go
./zerodupe-client
```

The client can be used to upload and download files from the server. The available commands are:

- `upload`: Upload a file to the server
- `download`: Download a file from the server

The client can be configured using command-line flags. The available flags are:

- `-server`: The URL of the server to connect to (default: `http://localhost:8080`)
- `-o`: The output directory for downloaded files (default: `.`)
- `-n`: The name of the downloaded file (default: the file hash)

## Example Usage

To upload a file to the server, use the following command:

```bash
./zerodupe-client upload -server http://localhost:8080 /path/to/file
```

To download a file from the server, use the following command:

```bash
./zerodupe-client download -server http://localhost:8080 -o /path/to/output -n custom_name.txt HASH
```

Where `HASH` is the hash of the file to download.
